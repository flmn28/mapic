<!DOCTYPE html>
<html>
  <head>
    <title>MAPIC</title>
    <%= csrf_meta_tags %>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://maps.google.com/maps/api/js?language=ja&key=AIzaSyBYSlqZU_XyHR3nrZn_KG5c_PJDX3QZl84"></script>
  </head>

  <body>
    <div class="background-image">
      <div class="background-wrapper">
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container-fluid">
            <div class="navbar-header">
              <% if yield(:show_cog) == 'true' %>
                <span class="option-toggle option-open-toggle"><%= fa_icon 'angle-double-right' %></span>
                <span class="option-toggle option-close-toggle"><%= fa_icon 'angle-double-left' %></span>
              <% elsif yield(:show_back) == 'true' %>
                <span class="back-btn sp-back-btn"><%= fa_icon 'chevron-left' %></span>
              <% end %>
              <button class="navbar-toggle" data-toggle="collapse" data-target=".target">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <%= link_to "MAPIC", root_path, class: "navbar-brand" %>
            </div>

            <div class="collapse navbar-collapse target">
              <ul class="nav navbar-nav navbar-right">
                <% if logged_in? %>
                  <li><%= link_to "マップ", root_path, class: yield(:root_nav) %></li>
                  <li><%= link_to "ランキング", ranking_path, class: yield(:ranking_nav) %></li>
                  <li><%= link_to "マイページ", mypage_path, class: yield(:mypage_nav) %></li>
                  <li class="dropdown">
                    <a class="dropdown-toggle <%= yield(:setting_nav) %>" data-toggle="dropdown">
                      ユーザー設定 <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "アカウント編集", edit_user_path(current_user.id) %></li>
                      <li><%= link_to "ログアウト", logout_path, method: :post %></li>
                    </ul>
                  </li>
                  <% else %>
                    <li><%= link_to "新規登録", signup_path %></li>
                    <li><%= link_to "ログイン", login_path %></li>
                  <% end %>
              </ul>
            </div>
          </div>
        </nav>

        <% if flash[:success] %>
          <div class="alert-box alert-success-box" id="alert-box">
            <p><%= flash[:success] %></p>
            <span id="alert-close-btn">&times;</span>
          </div>
        <% elsif flash[:warning] %>
          <div class="alert-box alert-warning-box" id="alert-box">
            <p><%= flash[:warning] %></p>
            <span id="alert-close-btn">&times;</span>
          </div>
        <% end %>

        <%= yield %>

      </div>
    </div>
  </body>
</html>

<script>
  var optionBar = $('#option-bar');

  $('.option-toggle').click(function() {
    if (optionBar.hasClass('option-bar-open')) {
      optionBar.animate({'left' : '-180px' }, 300);
      optionBar.removeClass('option-bar-open');
      $(this).css('display', 'none');
      $('.option-open-toggle').css('display', 'inline-block');
    } else {
      optionBar.animate({'left' : '0' }, 300);
      optionBar.addClass('option-bar-open');
      $(this).css('display', 'none');
      $('.option-close-toggle').css('display', 'inline-block');
    }
  });

  if ($(window).width() < 768) {
    $('#option-btn').click(function() {
      optionBar.animate({'left' : '-180px' }, 300);
      optionBar.removeClass('option-bar-open');
      $('.option-close-toggle').css('display', 'none');
      $('.option-open-toggle').css('display', 'inline-block');
    });
  }

  $('.back-btn').click(function() {
    history.back();
  });

  function closeFlash() {
    $('#alert-box').css('display', 'none');
    $('body').css('padding-top', '46px');
    $('.navbar').css('box-shadow', '0 2px 10px rgba(0, 0, 0, 0.3)');
  }

  <% if flash[:success] || flash[:warning] %>
    $('body').css('padding-top', '86px');
    $('.navbar').css('box-shadow', 'none');
    $('#alert-close-btn').click(function() {
      closeFlash();
    });
  <% end %>

  document.addEventListener("turbolinks:load", function() {
    if ((<%= !flash[:success] && !flash[:warning] %> && $('#alert-box').css('display') == 'block') ||
        ($('body').css('padding-top') == '86px' && $('#alert-box').css('display') == 'none')) {
      closeFlash();
    }
  });

</script>
